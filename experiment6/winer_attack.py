def gen():
    p = random_prime(2^1024)
    q = random_prime(2^1024)
    phi = (p-1)*(q-1)
    N = p*q
    d = randint(1,int(N^0.25/3))
    while(gcd(d,phi) != 1):
        d = randint(1,int(N^0.25/3))
    e = inverse_mod(d,phi)
    return p,q,e,d
p,q,e,d = gen()
N = p*q
print("生成参数")
print("p = ",p)
print("q = ",q)
print("e = ",e)
print("d = ",d)
def attack(e,N):
    z = continued_fraction(e/N)
    convs = z.convergents()
    for conv in convs:
        k = conv.numerator()
        d = conv.denominator()
        if k != 0:
            T = N - (e*d-1)//k +1 
            delta = T^2 - 4*N
            s = Integer(delta).isqrt()
            if s * s == delta:
                if (T + s) % 2 == 0:
                    p = (T + s) // 2
                    q = (T - s) // 2
                    return p,q
print("成功分解N",attack(e,N))
'''
生成参数
p =  113185324392554013739497266665091384394682831723538976334833595416360932615459114254369323432816420143597107032614382273788358202839619299544749689632859350566157150132930120390549268696028864613780834544146259138245976540994376077312217217640032310168614532323863434388943071958957727035229720380327224021753
q =  146553991898603464936249936575509757636025166707729111402068775681876151899753282168285476782858229985415480946921067704446591272264645043257898110727343060502047703712579912424019637213107458410922786521229422984316966018425782002388235247037518169534260142668087066165136141673551556655665019934218236463461
e =  3083668319345736846805026090960287040247098857597119217162070841376339100757083356559647856017526124492708180505453790253499076552297668408530128964057476156211519661841894047708735105725910641675919044836136876225404150970189675921387365702111868304074763145938174961266817951936684395934518243929417270101516342254860237136760800553220107372113488903312023789569276041479618345509056973950536327954358815157316110367699802887004800087633988549382683379919268654000326662750475490393111127477314399798459062876365855812232308145855675156052659617968285001581475094821603716845428992555747291925303185458550908388407
d =  2475627286777223072868692455124432291993495826888693110012368244537488085376256318454650455890479233077107098544992764125934422053179736037416554397159943
成功分解N (146553991898603464936249936575509757636025166707729111402068775681876151899753282168285476782858229985415480946921067704446591272264645043257898110727343060502047703712579912424019637213107458410922786521229422984316966018425782002388235247037518169534260142668087066165136141673551556655665019934218236463461, 113185324392554013739497266665091384394682831723538976334833595416360932615459114254369323432816420143597107032614382273788358202839619299544749689632859350566157150132930120390549268696028864613780834544146259138245976540994376077312217217640032310168614532323863434388943071958957727035229720380327224021753)
'''
